import java.io.File;
import java.io.FileNotFoundException;
import java.util.Date;
import java.util.Scanner;

/**
 * @author James & Kris
 *
 */
public class Parser{
	public static void main(String[] args) {
		League theLeague = new League();
		
		Date d = new Date();
		String thisLine, time = "", team1Name = "", team2Name= "", scoreOne = "", scoreTwo = "", date = "";
		Scanner fileScanner, lineScanner;
		int score1 = 0, score2 = 0;
		
		File source = new File("/users/level3/1007175s/Sports-Elimination-TP3/src/uk/ac/gla/dcs/tp3/w/parser/src/baseballSource.txt");
		try {
			fileScanner = new Scanner(source);				//scan over file object
			while(fileScanner.hasNextLine() || fileScanner.nextLine().isEmpty()){
				
				/**Setting the date*/
				if(fileScanner.nextLine().isEmpty()){
					date = fileScanner.nextLine();		
					lineScanner = new Scanner(date);
					d.setDate(lineScanner.nextInt());		//setting day
					String m = lineScanner.next();			
					d.setMonth(getMonth(m)-1);				//month converted to a number and stored
					d.setYear(lineScanner.nextInt());		//year
				}
				
				thisLine = fileScanner.nextLine();			//get each line one at a time(within a day)				
				lineScanner = new Scanner(thisLine);		//start new scanner to scan particular line
				
				/**parsing out information from a particular line*/
				time = lineScanner.next();						//store time
				//thisLine = thisLine.replaceAll("\\s+","");	//remove whitespace from string
				boolean hyphenCheck = false, atScore2 = false;
				for(int i = 0; i < thisLine.length(); i++){			//loop through characters in the line starting at first team name
				    char c = thisLine.charAt(i);
				    
				    if(c != '-' && hyphenCheck == false){
				    	team1Name += c;
				    }
				    if(hyphenCheck && (c != '0' && c != '1' && c != '2' && c != '3' && c != '4' && c != '5' && c != '6' && c != '7' && c != '8' && c != '9') && c != '\t' && c != ':'){
				    	team2Name += c;
				    }
				    if(c == '-'){
				    	hyphenCheck = true;
				    	i++;
				    }
				    if(c == '0' || c == '1' || c == '2' || c == '3' || c == '4' || c == '5' || c == '6' || c == '7' || c == '8' || c == '9' || c == ':'){
				    	/**if it hits a colon, working on team 2's score*/
				    	if(c == ':'){
				    		atScore2 = true;
				    		continue;
				    	}
				    	
				    	/**setting score's for teams 1 and 2*/
				    	if(atScore2){
				    		scoreTwo += c;
				    	}else{
				    		scoreOne += c;
				    	}
				    }
				}
				score1 = Integer.parseInt(scoreOne);
				score2 = Integer.parseInt(scoreTwo);

				Team t1 = new Team(team1Name);
				Team t2 = new Team(team2Name);
				
				/**Checking if the teams already exist, otherwise create them*/
				if(!theLeague.isMember(t1)){
					theLeague.addTeam(new Team(team1Name));
				}
				
				if(!theLeague.isMember(t2)){
					theLeague.addTeam(new Team(team2Name));
				}
				
				/**allocating points to the team which won the match*/
				if(score1 > score2){
					for(Team t: theLeague.getTeams()){
						if(t.equals(t1)){
							t.setPoints(t.getPoints()+1);
							break;
						}
					}
				}else{
					for(Team t: theLeague.getTeams()){
						if(t.equals(t2)){
							t.setPoints(t.getPoints()+1);
							break;
						}
					}
				}
				
				/**Creating match object*/
				Team temp1 = null, temp2 = null;
				for(Team t: theLeague.getTeams()){
					if(t.equals(t1)){
						temp1 = t;
					}
				}
				for(Team t: theLeague.getTeams()){
					if(t.equals(t2)){
						temp2 = t;
					}
				}
				Match match = new Match(temp1, temp2, score1, score2, d, false);
				theLeague.addFixture(match);
				
			}
		} catch (FileNotFoundException e){
			System.out.println("Wrong filename");
		}
	}
	
	/**Method to convert from string to int*/
	public static int getMonth(String month){
		month = month.toLowerCase();
		if(month.equals("jan")){
			return 1;
		}else if(month.equals("feb")){
			return 2;
		}else if(month.equals("mar")){
			return 3;
		}else if(month.equals("apr")){
			return 4;
		}else if(month.equals("may")){
			return 5;
		}else if(month.equals("jun")){
			return 6;
		}else if(month.equals("jul")){
			return 7;
		}else if(month.equals("aug")){
			return 8;
		}else if(month.equals("sep")){
			return 9;
		}else if(month.equals("oct")){
			return 10;
		}else if(month.equals("nov")){
			return 11;
		}else{
			return 12;
		}
	}
}
